# [0-5] E2E CoS Test - Verify full integration

[Back to task list](./tasks.md)

## Description

End-to-end testing to verify all components of PBI-0 work together correctly. This task validates that the backend and frontend can communicate, all acceptance criteria are met, and the development environment is fully functional. This is the final verification before marking PBI-0 as complete.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-11 00:00:00 | Created | N/A | Proposed | Task file created | Sean |

## Requirements

1. Verify all PBI-0 acceptance criteria are met
2. Test complete workflow from setup to running application
3. Validate frontend-backend communication
4. Verify hot reload functionality for both applications
5. Test all API endpoints from frontend
6. Verify mobile responsiveness
7. Confirm all configuration files are properly set up
8. Validate all scripts work correctly

## Implementation Plan

This is a testing task, so implementation consists of executing test scenarios and documenting results.

### Test Scenarios

#### 1. Fresh Setup Test
Simulate a new developer setting up the project:
```bash
# Clone repository (simulated)
cd /home/sean/workspace/janus

# Run setup script
./scripts/setup.sh

# Verify:
# - Script completes successfully
# - All dependencies installed
# - .env created from .env.example
# - .cursor-voice directory structure exists
```

#### 2. Backend Functionality Test
```bash
# Start backend
./scripts/dev-backend.sh

# In another terminal, test endpoints:
curl http://localhost:3000/api/health
# Verify: 200 response with JSON {"status":"ok",...}

curl -X POST http://localhost:3000/api/session/start
# Verify: 200 response with session_id

curl -X POST "http://localhost:3000/api/ask?session_id=test-123" \
  -H "Content-Type: application/json" \
  -d '{"question":"test question"}'
# Verify: 200 response with mock answer

curl -X POST http://localhost:3000/api/heartbeat?session_id=test-123
# Verify: 200 response

curl -X POST http://localhost:3000/api/session/end?session_id=test-123
# Verify: 200 response

# Test hot reload:
# Modify internal/api/handlers/health.go (add a field)
# Verify server auto-restarts
# Test endpoint again, verify change is reflected
```

#### 3. Frontend Functionality Test
```bash
# Start frontend (backend should already be running)
./scripts/dev-frontend.sh

# Open browser to http://localhost:3001

# Verify UI:
# - Page loads without errors
# - Status indicator shows "Connected" (green)
# - Backend version displayed
# - PushToTalk button visible and styled correctly
# - Layout is responsive

# Open browser console:
# - No errors
# - Network tab shows successful health check request

# Test hot reload:
# Modify app/page.tsx (change text)
# Verify page auto-refreshes
# Verify change is visible
```

#### 4. Mobile Responsiveness Test
```bash
# With frontend running:
# Open DevTools (F12)
# Toggle device toolbar (Ctrl+Shift+M)
# Test various viewports:
#   - iPhone SE (375x667)
#   - iPhone 12 Pro (390x844)
#   - Pixel 5 (393x851)
#   - iPad Mini (768x1024)

# Verify for each:
# - Layout adapts properly
# - PushToTalk button is large enough (200x200px)
# - Text is readable
# - No horizontal scroll
# - Touch targets are adequate (44x44pt minimum)
```

#### 5. CORS Verification Test
```bash
# With both servers running:
# Open frontend in browser (http://localhost:3001)
# Open browser DevTools → Network tab
# Trigger a health check request
# Inspect response headers:
# - Access-Control-Allow-Origin: http://localhost:3001
# - Other CORS headers present

# Verify no CORS errors in console
```

#### 6. Build Test
```bash
# Build production artifacts
./scripts/build.sh

# Verify:
# - bin/janus binary created
# - Binary is executable
# - Frontend build completes (.next directory created)

# Test binary:
cd /home/sean/workspace/janus
PORT=3002 ./bin/janus &
# Wait for startup
curl http://localhost:3002/api/health
# Verify: 200 response
# Kill process
```

#### 7. Configuration Test
```bash
# Test environment variables
cat .env
# Verify PORT, LOG_LEVEL, etc. are set

# Test with different PORT
echo "PORT=3005" >> .env
./scripts/dev-backend.sh
# Verify server starts on port 3005
curl http://localhost:3005/api/health

# Reset to default PORT=3000
```

#### 8. Git Ignore Test
```bash
# Create files that should be ignored
touch .env.local
mkdir -p bin
touch bin/janus
mkdir -p frontend/node_modules
touch test.log

# Check git status
git status
# Verify these files don't appear as untracked

# Create files that should NOT be ignored
touch cmd/server/test.go
git status
# Verify this appears as untracked
```

## Test Plan

This entire task IS the test plan. The implementation plan above details all test scenarios.

### Success Criteria

All PBI-0 acceptance criteria must pass:

#### Backend Criteria
- [ ] Go module initialized with proper package name
- [ ] Directory structure created following Go best practices
- [ ] Backend HTTP server starts successfully on port 3000
- [ ] `GET /api/health` returns JSON with status and version
- [ ] Stub session endpoints return 200 with mock responses
- [ ] CORS middleware configured and functional
- [ ] Configuration loads from environment variables

#### Frontend Criteria
- [ ] Next.js 15.5.4+ app initialized in frontend/ directory with React 19.2.0+
- [ ] Frontend runs successfully on port 3001
- [ ] Tailwind CSS configured and working
- [ ] API client implemented with health check method
- [ ] Frontend displays backend health status on load
- [ ] Frontend can successfully call backend API
- [ ] CORS allows frontend to call backend

#### Development Criteria
- [ ] Hot reload works for backend (air)
- [ ] Hot reload works for frontend (Next.js dev)
- [ ] setup.sh script completes successfully
- [ ] dev-backend.sh starts backend with hot reload
- [ ] dev-frontend.sh starts frontend with hot reload
- [ ] build.sh produces working binaries

#### Configuration Criteria
- [ ] .env.example file created with all variables documented
- [ ] .gitignore properly excludes build artifacts and env files
- [ ] README.md has quick start instructions
- [ ] .cursor-voice/ directory structure created

## Verification

Execute all test scenarios from the Implementation Plan section above and document results.

### Execution Checklist

```bash
# 1. Fresh Setup Test
cd /home/sean/workspace/janus
./scripts/setup.sh
# ✓ Script completes
# ✓ Dependencies installed
# ✓ .env created
# ✓ Directories created

# 2. Backend Test
./scripts/dev-backend.sh
# In another terminal:
curl http://localhost:3000/api/health
curl -X POST http://localhost:3000/api/session/start
curl -X POST "http://localhost:3000/api/ask?session_id=test" -d '{"question":"test"}'
curl -X POST http://localhost:3000/api/heartbeat?session_id=test
curl -X POST http://localhost:3000/api/session/end?session_id=test
# Modify a file → verify hot reload
# ✓ All endpoints work
# ✓ Hot reload works

# 3. Frontend Test
./scripts/dev-frontend.sh
# Open http://localhost:3001
# ✓ Page loads
# ✓ Status shows connected
# ✓ UI renders correctly
# ✓ No console errors
# Modify component → verify hot reload
# ✓ Hot reload works

# 4. Mobile Test
# Open DevTools, test various viewports
# ✓ Responsive on all sizes
# ✓ Touch targets adequate

# 5. CORS Test
# Inspect network requests in browser
# ✓ CORS headers present
# ✓ No CORS errors

# 6. Build Test
./scripts/build.sh
./bin/janus &
curl http://localhost:3002/api/health
# ✓ Binary works

# 7. Config Test
# Test PORT override
# ✓ Environment variables work

# 8. Git Ignore Test
# Create test files, check git status
# ✓ Correct files ignored
```

### Pass Criteria

All checkboxes in Success Criteria must be checked ✓ before marking task as complete.

## Files Modified

### No New Files
This is a testing task - it verifies existing implementation.

### Potentially Modified Files
- `.env` (during testing)
- Test files created and deleted during verification

### Test Artifacts
Consider creating:
- `docs/testing/pbi-0-test-results.md` (optional documentation of test results)

