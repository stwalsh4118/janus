# [0-1] Initialize Go backend with Gin framework

[Back to task list](./tasks.md)

## Description

Set up the foundational Go backend structure with Gin framework, including directory organization, basic HTTP server with graceful shutdown, health check endpoint, and stub session management endpoints. This establishes the backend foundation for incremental development.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-11 00:00:00 | Created | N/A | Proposed | Task file created | Sean |
| 2025-10-11 00:00:01 | Status Update | Proposed | Agreed | Task approved by user | Sean |
| 2025-10-11 00:00:02 | Status Update | Agreed | InProgress | Started implementation | Sean |
| 2025-10-11 00:00:03 | Status Update | InProgress | Review | Implementation complete, ready for review | Sean |

## Requirements

1. Initialize Go module with proper package name
2. Create standard Go project directory structure (`cmd/`, `internal/`)
3. Install and configure Gin framework with required dependencies
4. Implement HTTP server with graceful shutdown
5. Create health check endpoint returning JSON
6. Create stub session management endpoints (mock responses)
7. Configure CORS middleware for development
8. Implement basic configuration loading from environment variables
9. Set up air configuration for hot reload development

## Implementation Plan

### 1. Initialize Go Module
```bash
go mod init github.com/sean/janus
```

### 2. Install Dependencies
```bash
go get -u github.com/gin-gonic/gin
go get -u github.com/gin-contrib/cors
go get -u github.com/joho/godotenv
```

### 3. Create Directory Structure
```
cmd/
  server/
    main.go              # Entry point
internal/
  api/
    handlers/
      health.go          # Health check handler
      session.go         # Session handlers (stub)
    middleware/
      cors.go            # CORS configuration
    router.go            # Route setup
  config/
    config.go            # Configuration struct and loader
  session/
    manager.go           # Session manager (stub)
```

### 4. Implement Core Files

**cmd/server/main.go**:
- Load configuration
- Initialize Gin router
- Set up routes
- Start server with graceful shutdown

**internal/config/config.go**:
- Define Config struct
- Load from environment variables
- Validation

**internal/api/router.go**:
- Set up Gin router
- Apply CORS middleware
- Register routes

**internal/api/handlers/health.go**:
- Implement `GET /api/health`
- Return JSON with status, version, uptime

**internal/api/handlers/session.go**:
- Stub implementation of:
  - `POST /api/session/start` → returns mock session_id
  - `POST /api/ask?session_id={id}` → returns mock response
  - `POST /api/session/end?session_id={id}` → returns success
  - `POST /api/heartbeat?session_id={id}` → returns success

**internal/api/middleware/cors.go**:
- Configure CORS for localhost:3001 (frontend dev server)

**internal/session/manager.go**:
- Stub Session struct
- Stub SessionManager with basic methods

### 5. Configure Air
Create `.air.toml` in project root for hot reload configuration.

## Test Plan

### Unit Tests
- Not required for this initial setup task (focus on integration)

### Integration Tests
Manual verification:
1. Server starts successfully on configured port (default 3000)
2. `GET /api/health` returns 200 with valid JSON
3. Stub session endpoints return 200 with mock data
4. CORS headers present in responses
5. Air hot reload works (modify code, verify auto-restart)

### Success Criteria
- [ ] Go module initialized
- [ ] All dependencies installed
- [ ] Directory structure created
- [ ] Server starts without errors
- [ ] Health endpoint accessible and returns proper JSON
- [ ] All stub session endpoints return 200
- [ ] CORS middleware configured
- [ ] Configuration loads from environment
- [ ] Air hot reload functional
- [ ] Code compiles without errors
- [ ] Server can be gracefully shutdown

## Verification

Manual testing steps:
```bash
# 1. Start server
cd /home/sean/workspace/janus
air

# 2. Test health endpoint
curl http://localhost:3000/api/health

# 3. Test session endpoints
curl -X POST http://localhost:3000/api/session/start
curl -X POST http://localhost:3000/api/ask?session_id=test123 -d '{"question":"test"}'
curl -X POST http://localhost:3000/api/heartbeat?session_id=test123
curl -X POST http://localhost:3000/api/session/end?session_id=test123

# 4. Verify hot reload - modify health.go, verify auto-restart

# 5. Verify CORS - check response headers
curl -i http://localhost:3000/api/health
```

## Files Modified

### New Files
- `go.mod`
- `go.sum`
- `.air.toml`
- `cmd/server/main.go`
- `internal/config/config.go`
- `internal/api/router.go`
- `internal/api/handlers/health.go`
- `internal/api/handlers/session.go`
- `internal/api/middleware/cors.go`
- `internal/session/manager.go`

