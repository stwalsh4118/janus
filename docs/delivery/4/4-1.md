# [4-1] Add PWA support and Web Speech API types

[Back to task list](./tasks.md)

## Description

Add PWA manifest and mobile optimization meta tags to the existing Next.js application in `/web`. Add TypeScript type definitions for Web Speech API to support voice recognition and synthesis features.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-12 00:00:00 | Created | N/A | Proposed | Task file created | Sean |
| 2025-10-12 14:30:00 | Status Update | Proposed | Agreed | Task approved and implementation started | Sean |
| 2025-10-12 14:45:00 | Status Update | Agreed | InProgress | Creating Web Speech API types and PWA manifest | Sean |
| 2025-10-12 15:00:00 | Status Update | InProgress | Review | Implementation complete, all files created | Sean |
| 2025-10-12 15:05:00 | Status Update | Review | Done | TypeScript compilation verified, manifest valid, task approved | Sean |

## Requirements

**Current State:** Next.js app exists in `/web` with shadcn/ui, API client, PushToTalk and StatusIndicator components. Basic session management working but no Web Speech API types or PWA features.

1. Add TypeScript definitions for Web Speech API:
   - Create types file with proper interfaces
   - Handle webkit prefixes for Safari
   - Support both SpeechRecognition and SpeechSynthesis
   
2. Create PWA manifest:
   - Define app metadata
   - Configure icons and display mode
   - Set up for add-to-home-screen capability

3. Add mobile optimization meta tags to layout:
   - Viewport configuration to prevent zoom
   - Mobile web app capability flags
   - Status bar styling for iOS
   - Theme color for Android

## Implementation Plan

### 1. Create Web Speech API Type Definitions
```typescript
// web/lib/types/speech.d.ts
declare global {
  interface Window {
    webkitSpeechRecognition: typeof SpeechRecognition;
    SpeechRecognition: typeof SpeechRecognition;
  }

  interface SpeechRecognitionEvent extends Event {
    results: SpeechRecognitionResultList;
    resultIndex: number;
  }

  interface SpeechRecognitionErrorEvent extends Event {
    error: string;
    message: string;
  }
}

export {};
```

### 2. Update app/layout.tsx with Mobile Meta Tags
```typescript
// web/app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <head>
        {/* PWA */}
        <link rel="manifest" href="/manifest.json" />
        
        {/* Mobile Optimizations */}
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="theme-color" content="#000000" />
        
        {/* Icons */}
        <link rel="icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/icon-192.png" />
      </head>
      <body>{children}</body>
    </html>
  );
}
```

### 3. Create PWA Manifest
```json
// web/public/manifest.json
{
  "name": "Janus - Voice Portal to Your Codebase",
  "short_name": "Janus",
  "description": "Voice-enabled interface for asking questions about your codebase while driving",
  "start_url": "/",
  "display": "standalone",
  "orientation": "portrait",
  "background_color": "#000000",
  "theme_color": "#000000",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```


## Test Plan

### Success Criteria

Since this is a foundational configuration task:

- [ ] TypeScript types for Web Speech API compile without errors
- [ ] Web Speech API types include webkit prefixes for Safari compatibility
- [ ] PWA manifest.json exists in `web/public/`
- [ ] Manifest is valid JSON with all required fields
- [ ] app/layout.tsx contains mobile optimization meta tags
- [ ] Viewport meta tag configured to prevent zoom
- [ ] Mobile web app capability flags present
- [ ] Theme color configured for Android
- [ ] Apple-specific meta tags configured for iOS
- [ ] Development server works (`pnpm dev`)
- [ ] Manifest accessible at http://localhost:3001/manifest.json
- [ ] TypeScript compilation succeeds: `pnpm tsc --noEmit`

## Verification

```bash
cd /home/sean/workspace/janus/web

# Verify TypeScript compilation
pnpm tsc --noEmit

# Check manifest exists
cat public/manifest.json

# Verify it's valid JSON
cat public/manifest.json | jq .

# Start development server
pnpm dev

# In browser, test:
# 1. http://localhost:3001/ - should load the app
# 2. http://localhost:3001/manifest.json - should return manifest
# 3. Open DevTools > Application > Manifest - verify PWA config
# 4. Check Console for any TypeScript errors
# 5. Verify viewport meta tag in Elements tab
```

## Files Modified

### New Files
- `web/lib/types/speech.d.ts` - Web Speech API type definitions
- `web/public/manifest.json` - PWA manifest

### Modified Files
- `web/app/layout.tsx` - Add mobile optimization meta tags and PWA link


